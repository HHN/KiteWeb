# This file is a template, and might need editing before it works on your project.
# To contribute improvements to CI/CD templates, please follow the Development guide at:
# https://docs.gitlab.com/development/cicd/templates/
# This specific template is located at:
# https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Pages/HTML.gitlab-ci.yml

# Full project: https://gitlab.com/pages/plain-html
image: alpine:latest

pages:
  stage: deploy

  # Wir brauchen gzip (ist an Bord) und brotli
  before_script:
    - apk add --no-cache brotli

  script:
    # neues public-Verzeichnis
    - rm -rf public && mkdir public

    # 1) Kopiere deine Unity-Ausgabe
    - cp index.html public/
    - cp Build/Kite2Web.data public/
    - cp Build/Kite2Web.framework.js public/
    - cp Build/Kite2Web.loader.js public/
    - cp Build/Kite2Web.wasm public/
    - cp StreamingAssets/*.txt public/  || true
    - cp StreamingAssets/*.json public/ || true

    # 2) Für jede Datei: .gz und .br erzeugen
    - |
      for f in public/*; do
        case "$f" in
          *.gz|*.br) 
            # schon komprimiert – überspringen
            continue
            ;;
        esac
        gzip -9 -k "$f"
        brotli --quality=11 -k "$f"
      done

  artifacts:
    paths:
      - public
    expire_in: 1 week

  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH